<!DOCTYPE html>  
<html>  
  <head>  
    <title>Calculate Your Meal Cost</title>  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <!-- Bootstrap -->  
    <link href="../bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" media="screen">  
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
var myusername;
var result;

function doMath() {
	var table=document.getElementById("myTable");
	var total = 0;
	var servings = 0;
	for (var i = 0; i < result.length; i++){
		servings = table.rows[i].cells[1].innerHTML.getElementById('servings_input').value;
		total += servings / result[i].quantity * results[i].price;
	}
    document.getElementById('total_input').value = total;
}

function getdata(){
	var xmlhttp0 = new XMLHttpRequest();
	xmlhttp0.onreadystatechange=function(){
		if (xmlhttp0.readyState == 4){
			var usernameresponse = JSON.parse(xmlhttp0.response);
			myusername = usernameresponse.name;
			getfood();
		}
	}
	xmlhttp0.open("GET", "/user", true);
	xmlhttp0.send();
}

function getfood(){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange=function()
  	{
  if (xmlhttp.readyState==4)
    {
		var table=document.getElementById("myTable");
		result = JSON.parse(xmlhttp.response);
		for (var i = 0; i < result.length; i++){
			var row=table.insertRow(0);
			var cell1=row.insertCell(0);
			var cell2=row.insertCell(1);
			var f = document.createElement("form");
			f.setAttribute('method',"post");
			f.setAttribute('action',"submit.php");
			
			var k = document.createElement("input");
			k.setAttribute('type',"text");
			k.setAttribute('id',"servings_input");
			k.setAttribute('onBlur',"doMath();");
			f.appendChild(k);

			cell1.innerHTML=result[i].food;
			cell2.innerHTML=k;
		}
    }
  }

	xmlhttp.open("GET", "/pantry?username=" + myusername, true);
	xmlhttp.send();
}

function add_meal(){
    var mealName = document.getElementById('meal_name').value;
    var mealCost = document.getElementById('total_input').value;
    
    $.post(
 	 "/submit",
  	{ username: myusername, meal: mealName, mealTotal: mealCost },
  	function(data) {
 	 }
	); 
}

</script>
</head>
<body onload="getdata()">

<h1> Calculate Your Meal Cost </h1>

<table id="myTable" class="table table-bordered">  
    <thead>  
        <tr>  
          <th>Item</th>  
          <th>Servings</th>  
        </tr>  
    </thead>  
    <tbody>   
    </tbody>  
</table> 
<div>Total: <input type="text" id="total_input" value="0" readonly="true" /></div>


<div>Meal Name: <input type="text" id="meal_name" onBlur="add_meal()" /></div>

<a href="graph.html" class="btn btn-info btn-lg active" >I'm Done!</a>


</body>
</HTML>